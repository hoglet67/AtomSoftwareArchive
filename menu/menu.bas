
5 ?#23=0;?#24=#33
6 ?#D=0;?#E=#33
10 *NOMON
20 CLEAR 4
30 *LOAD SCREEN2.ATM
40 P.$21
55 GOS.z
56 CLEAR 0
57 P.$6
60 *LOAD MNU/MENUDAT
70 *LOAD MNU/SORTDAT
80 REM ATOMMC SELECTION MENU
90 
100 REM GENERAL SETTINGS
110 P=1;L=13;Y=0
113 M=(!#3602&#FFFF-!#3600&#FFFF)/2-1
114 M=(M+L-1)/L
115 Z=#3608
120 
130 REM PAGE HEADER
140 P.$12;?#E1=0
150 P."€page€€of€€press€Ÿ€for€help€"'
160 ?#8006=P/10+176;?#8007=P%10+176
170 ?#800C=M/10+176;?#800D=M%10+176
180 
210 REM BUILD MENUPAGE
220 P.$30''
230 !#80=Z+(P-1)*26
240 LINK LL0
310 GOS.i
320 
330 REM SHIFT-KEY
340 IF ?#B001&128>0;G.410
350  IF Y>0;G.380
360  IF P=1;G.340
370  P=P-1;GOS.i;Y=12;G.160
380  GOS.i;Y=Y-1;GOS.i;G.340
390 
400 REM CTRL-KEY
410 IF?#B001&64>0;G.453
420  IF Y<>12;G.450
430  IF P=M;G.340
440  P=P+1;GOS.i;Y=0;G.160
450  GOS.i;Y=Y+1;GOS.i;G.340
451 
452 REM REPT-KEY
453 IF?#B002&64>0;G.460
454 P=(P%M)+1;GOS.i;Y=0;G.160
460 LINK LL15
461 IF ?#80=0;G.340
462 IF ?#80>32 AND ?#80<46;Y=?#80-33
463 I=(P-1)*13+Y
464 J=Z!(I*2)
467 K=(!J)&#3FF
480 P=#100
481 $P="RUN MNU/"
482 P=P+LEN(P)
483 IF K>99;?P=48+(K/100)%10;P=P+1
484 IF K>9;?P=48+(K/10)%10;P=P+1
485 ?P=48+K%10
486 P?1=13
487 P?2=13
488 LINK #FFF7
490 END
500iA=#8040+Y*32
510 F.I=0TO31S.4;I!A=I!A:#80808080;N.
520 R.
1000zREM FAST MENU RENDERING
1005 DIM LL(20)
1010 F.I=0 TO 20;LL(I)=-1;N.
1020 F.I=0 TO 1
1030 DIM P(-1)
1040[
1045:LL0
1050\#80,#81 POINTS INTO THE SORT INDEX
1055 LDA #8202
1056 STA #84
1057 LDA #8203
1058 STA #85
1060 LDA @#40
1061 STA #88
1062 LDA @#80
1063 STA #89
1070 LDY @0
1075:LL1
1080 LDA (#80),Y
1090 STA #82
1100 INY
1110 LDA (#80),Y
1120 STA #83
1121 INY
1122 CMP @255
1123 BEQ LL9
1130\#82,83 IS THE MAIN RECORD
1140 TYA
1150 PHA
1151 CLC
1152 LSR A
1153 ADC @64
1154 JSR LL17
1155 LDA @#2E
1156 JSR LL17
1157 LDX @30
1160 LDY @4
1170:LL2
1180 LDA (#82),Y
1190 CMP @13
1200 BEQ LL3
1210 JSR LL17
1215 DEX
1220 INY
1230 BNE LL2
1240:LL3
1310 LDY @2
1320 LDA (#82),Y
1330 CLC
1340 ASL A
1350 TAY
1351 LDA (#84),Y
1352 STA #86
1353 INY
1354 LDA (#84),Y
1355 STA #87
1360 LDY @0
1370:LL4
1380 LDA (#86),Y
1390 CMP @13
1400 BEQ LL5
1410 DEX
1420 INY
1430 BNE LL4
1440:LL5
1450 LDA @32
1460:LL6
1470 JSR LL17
1480 DEX
1490 BNE LL6
1500 LDY @0
1520:LL7
1530 LDA (#86),Y
1540 CMP @13
1550 BEQ LL8
1560 JSR LL17 
1570 INY
1580 BNE LL7
1585:LL8
1590 PLA
1600 TAY
1610 CPY @26
1620 BNE LL1
1630 RTS
1640:LL9
1641 CPY @28
1642 BEQ LL11
1650 LDX @32
1655 TXA
1660:LL10
1670 JSR LL17
1680 DEX
1690 BNE LL10
1700 INY
1710 INY
1730 BNE LL9
1735:LL11
1740 RTS
1750:LL15
1760 JSR #FE71
1770 BCC LL16
1780 LDY @0
1790:LL16
1800 STY #80
1810 RTS
1900:LL17
1901 STY #8A
1902 LDY @0
1910 AND @#3F
1920 STA (#88),Y
1930 INC #88
1940 BNE LL18
1950 INC #89
1960:LL18
1965 LDY #8A
1970 RTS
2000]
2010 N.
2030 RETURN
